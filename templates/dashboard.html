{% extends "base.html" %}

{% block title %}{{ get_text('dashboard', lang) }} - Poultry Farm Management{% endblock %}

{% block content %}
<div class="container my-4">
    <!-- Header with Farm Score -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="mb-1">Farm Dashboard</h1>
            <p class="text-muted">Welcome back, {{ session.username }}! Here's your farm overview.</p>
        </div>
        <div class="col-md-4 text-end">
            <div class="card border-0 shadow-sm bg-primary bg-opacity-10">
                <div class="card-body text-center py-3">
                    <h4 class="text-primary mb-1">Farm Score</h4>
                    <h2 class="text-primary">{{ "%.0f"|format(gamification.completion_rate) }}/100</h2>
                    <small class="text-muted">Level {{ gamification.level }} Farmer</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Regional Disease Alerts -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-warning">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h6 class="alert-heading mb-1">
                            <i class="fas fa-exclamation-triangle me-2"></i>Regional Disease Alert
                        </h6>
                        <p class="mb-1"><strong>Bird Flu (H5N1)</strong> detected in Nearby District (25km away)</p>
                        <small class="text-muted">Last updated: 2 hours ago ‚Ä¢ Reported by State Animal Husbandry Dept.</small>
                    </div>
                    <div class="col-md-4 text-end">
                        <span class="badge bg-warning fs-6 px-3 py-2">Medium Risk</span>
                        <div class="mt-2">
                            <a href="{{ url_for('alerts') }}" class="btn btn-sm btn-outline-warning">View Details</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Temperature Alert (if any) -->
    {% if temp_alert %}
    <div class="alert alert-{{ 'danger' if temp_alert.status == 'critical' else 'warning' }} mb-4">
        <i class="fas fa-thermometer-half me-2"></i>
        <strong>{{ temp_alert.status.title() }} Alert:</strong> {{ temp_alert.message }}
    </div>
    {% endif %}
    
    <!-- Farm Health Status -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h5 class="card-title mb-1">
                                <i class="fas fa-shield-alt me-2"></i>Farm Health Status
                            </h5>
                            <p class="text-muted mb-0">Biosecurity and sanitation monitoring</p>
                        </div>
                        <div class="text-end">
                            {% set status_colors = {'good': 'success', 'warning': 'warning', 'critical': 'danger'} %}
                            <span class="badge bg-{{ status_colors[health_status] }} fs-6 px-3 py-2">
                                <i class="fas fa-circle me-1"></i>{{ health_status.title() }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Visual Summary Cards for Rural Farmers -->
    <div class="row g-4 mb-5">
        <!-- Chickens Card with Visual Progress -->
        <div class="col-md-6 col-lg-3">
            <div class="card border-0 shadow-lg h-100 position-relative" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                <div class="card-body text-center">
                    <div class="position-relative mb-3">
                        <div class="bg-primary rounded-circle p-4 d-inline-flex shadow" style="width: 80px; height: 80px;">
                            <i class="fas fa-dove fa-3x text-white"></i>
                        </div>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success shadow">
                            Active
                        </span>
                    </div>
                    <h2 class="card-title text-primary fw-bold mb-1">{{ summary.total_chickens }}</h2>
                    <p class="card-text fs-6 text-dark fw-medium">üêî ‡§Æ‡•Å‡§∞‡•ç‡§ó‡§ø‡§Ø‡§æ‡§Ç / Chickens</p>
                    <div class="progress mt-2" style="height: 8px;">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: {{ (summary.total_chickens/200)*100 }}%"></div>
                    </div>
                    <small class="text-muted">Capacity: 200</small>
                </div>
            </div>
        </div>
        
        <!-- Eggs Card with Visual Indicator -->
        <div class="col-md-6 col-lg-3">
            <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);">
                <div class="card-body text-center">
                    <div class="position-relative mb-3">
                        <div class="bg-info rounded-circle p-4 d-inline-flex shadow" style="width: 80px; height: 80px;">
                            <i class="fas fa-egg fa-3x text-white"></i>
                        </div>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark shadow">
                            Daily
                        </span>
                    </div>
                    <h2 class="card-title text-info fw-bold mb-1">{{ summary.eggs_today }}</h2>
                    <p class="card-text fs-6 text-dark fw-medium">ü•ö ‡§Ö‡§Ç‡§°‡•á / Eggs Today</p>
                    <div class="d-flex justify-content-center align-items-center">
                        {% for i in range(5) %}
                            <i class="fas fa-egg text-{{ 'warning' if (summary.eggs_today/30) > i else 'muted' }} mx-1"></i>
                        {% endfor %}
                    </div>
                    <small class="text-muted">Production Rate: {{ "%.1f"|format((summary.eggs_today/summary.total_chickens)*100) if summary.total_chickens > 0 else 0 }}%</small>
                </div>
            </div>
        </div>
        
        <!-- Feed Card with Visual Gauge -->
        <div class="col-md-6 col-lg-3">
            <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #fff3e0 0%, #ffcc02 100%);">
                <div class="card-body text-center">
                    <div class="position-relative mb-3">
                        <div class="bg-warning rounded-circle p-4 d-inline-flex shadow" style="width: 80px; height: 80px;">
                            <i class="fas fa-seedling fa-3x text-white"></i>
                        </div>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger shadow">
                            Feed
                        </span>
                    </div>
                    <h2 class="card-title text-dark fw-bold mb-1">{{ "%.1f"|format(summary.feed_today) }}</h2>
                    <p class="card-text fs-6 text-dark fw-medium">üåæ ‡§¶‡§æ‡§®‡§æ ‡§ï‡§ø‡§≤‡•ã / Feed (kg)</p>
                    <div class="row text-center mt-2">
                        <div class="col-4">
                            <i class="fas fa-circle text-{{ 'success' if summary.feed_today < 20 else 'muted' }}"></i>
                            <br><small>Low</small>
                        </div>
                        <div class="col-4">
                            <i class="fas fa-circle text-{{ 'warning' if 20 <= summary.feed_today <= 30 else 'muted' }}"></i>
                            <br><small>Normal</small>
                        </div>
                        <div class="col-4">
                            <i class="fas fa-circle text-{{ 'danger' if summary.feed_today > 30 else 'muted' }}"></i>
                            <br><small>High</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Profit/Loss Card with Visual Status -->
        <div class="col-md-6 col-lg-3">
            <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, {{ '#e8f5e8' if summary.profit_loss >= 0 else '#ffeaea' }} 0%, {{ '#c8e6c9' if summary.profit_loss >= 0 else '#ffcdd2' }} 100%);">
                <div class="card-body text-center">
                    <div class="position-relative mb-3">
                        <div class="bg-{{ 'success' if summary.profit_loss >= 0 else 'danger' }} rounded-circle p-4 d-inline-flex shadow" style="width: 80px; height: 80px;">
                            <i class="fas fa-{{ 'arrow-trend-up' if summary.profit_loss >= 0 else 'arrow-trend-down' }} fa-3x text-white"></i>
                        </div>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-{{ 'success' if summary.profit_loss >= 0 else 'danger' }} shadow">
                            {{ 'Profit' if summary.profit_loss >= 0 else 'Loss' }}
                        </span>
                    </div>
                    <h2 class="card-title text-{{ 'success' if summary.profit_loss >= 0 else 'danger' }} fw-bold mb-1">
                        ‚Çπ{{ "%.0f"|format(abs(summary.profit_loss)) }}
                    </h2>
                    <p class="card-text fs-6 text-dark fw-medium">
                        {{ 'üí∞ ‡§´‡§æ‡§Ø‡§¶‡§æ / Profit' if summary.profit_loss >= 0 else 'üìâ ‡§®‡•Å‡§ï‡§∏‡§æ‡§® / Loss' }}
                    </p>
                    <div class="mt-2">
                        {% if summary.profit_loss >= 0 %}
                            <i class="fas fa-thumbs-up text-success fa-2x"></i>
                            <br><small class="text-success fw-medium">Good Performance!</small>
                        {% else %}
                            <i class="fas fa-exclamation-triangle text-danger fa-2x"></i>
                            <br><small class="text-danger fw-medium">Need Improvement</small>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Gamification Section -->
    <div class="row g-4 mb-4">
        <div class="col-md-8">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title mb-3">
                        <i class="fas fa-tasks me-2 text-success"></i>Today's Biosecurity Tasks
                    </h5>
                    <div class="row g-3">
                        {% for task in tasks %}
                        <div class="col-md-6">
                            <div class="card border-0 {{ 'bg-success bg-opacity-10 border-success' if task.completed else 'bg-secondary bg-opacity-10' }}">
                                <div class="card-body p-3">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div>
                                            <h6 class="mb-1 {{ 'text-success' if task.completed else 'text-dark' }}">{{ task.name }}</h6>
                                            <small class="{{ 'text-success' if task.completed else 'text-muted' }}">+{{ task.points }} points</small>
                                        </div>
                                        <div>
                                            {% if task.completed %}
                                                <i class="fas fa-check-circle text-success fa-2x"></i>
                                            {% else %}
                                                <button class="btn btn-sm btn-outline-primary complete-task" data-task-id="{{ task.id }}">
                                                    <i class="fas fa-check me-1"></i>Complete
                                                </button>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <h5 class="card-title">
                        <i class="fas fa-trophy me-2 text-warning"></i>Progress & Rewards
                    </h5>
                    <div class="mb-3">
                        <h3 class="text-primary">{{ gamification.points }}</h3>
                        <small class="text-muted">Total Points</small>
                    </div>
                    <div class="progress mb-3" style="height: 10px;">
                        <div class="progress-bar" role="progressbar" 
                             style="width: {{ (gamification.points % 100) }}%"></div>
                    </div>
                    <small class="text-muted">{{ gamification.next_level_points - gamification.points }} points to Level {{ gamification.level + 1 }}</small>
                    
                    <div class="mt-3">
                        <h6>Badges Earned</h6>
                        {% for badge in gamification.badges %}
                        <span class="badge bg-warning text-dark me-1 mb-1">{{ badge }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Financial Summary -->
    <div class="row g-4 mb-4">
        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-dollar-sign me-2 text-success"></i>Financial Overview
                    </h5>
                    <div class="row text-center">
                        <div class="col-4">
                            <h4 class="text-success">‚Çπ{{ "%.0f"|format(financial.total_revenue) }}</h4>
                            <small class="text-muted">Revenue</small>
                        </div>
                        <div class="col-4">
                            <h4 class="text-danger">‚Çπ{{ "%.0f"|format(financial.total_expenses) }}</h4>
                            <small class="text-muted">Expenses</small>
                        </div>
                        <div class="col-4">
                            <h4 class="text-{{ 'success' if financial.profit_loss >= 0 else 'danger' }}">
                                ‚Çπ{{ "%.0f"|format(financial.profit_loss) }}
                            </h4>
                            <small class="text-muted">Net Profit/Loss</small>
                        </div></div>
                    </div>
                    <div class="mt-3">
                        <a href="{{ url_for('financial') }}" class="btn btn-outline-success btn-sm">
                            View Details <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-lightbulb me-2 text-warning"></i>Future Benefits
                    </h5>
                    <p class="text-muted mb-3">Keep completing tasks to unlock:</p>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Higher chicken growth rates</li>
                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Reduced disease outbreaks</li>
                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Government scheme eligibility</li>
                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Premium company contracts</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Visual Quick Actions for Rural Farmers -->
    <div class="row g-4">
        <div class="col-md-6 col-lg-3">
            <div class="card border-0 shadow-lg h-100 hover-card" style="background: linear-gradient(135deg, #e3f2fd 0%, #2196f3 100%); cursor: pointer;" onclick="location.href='{{ url_for('add_data') }}'">
                <div class="card-body text-center text-white">
                    <div class="mb-3">
                        <i class="fas fa-edit fa-4x mb-2"></i>
                        <h5 class="card-title fw-bold">üìù ‡§°‡•á‡§ü‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</h5>
                        <h6 class="card-subtitle">Add Today's Data</h6>
                    </div>
                    <p class="card-text">Record chickens, eggs, feed & expenses</p>
                    <div class="btn btn-light btn-lg w-100 fw-bold text-primary">
                        <i class="fas fa-arrow-right me-2"></i>Enter Data
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 col-lg-3">
            <div class="card border-0 shadow-lg h-100 hover-card" style="background: linear-gradient(135deg, #e8f5e8 0%, #4caf50 100%); cursor: pointer;" onclick="location.href='{{ url_for('diseases') }}'">
                <div class="card-body text-center text-white">
                    <div class="mb-3">
                        <i class="fas fa-heartbeat fa-4x mb-2"></i>
                        <h5 class="card-title fw-bold">üè• ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ú‡§æ‡§Ç‡§ö</h5>
                        <h6 class="card-subtitle">Health Check</h6>
                    </div>
                    <p class="card-text">Disease solutions & treatments</p>
                    <div class="btn btn-light btn-lg w-100 fw-bold text-success">
                        <i class="fas fa-stethoscope me-2"></i>Check Health
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 col-lg-3">
            <div class="card border-0 shadow-lg h-100 hover-card" style="background: linear-gradient(135deg, #fff3e0 0%, #ff9800 100%); cursor: pointer;" onclick="location.href='{{ url_for('chat') }}'">
                <div class="card-body text-center text-white">
                    <div class="mb-3">
                        <i class="fas fa-handshake fa-4x mb-2"></i>
                        <h5 class="card-title fw-bold">ü§ù ‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞‡•Ä ‡§∏‡•á ‡§¨‡§æ‡§§</h5>
                        <h6 class="card-subtitle">Connect</h6>
                    </div>
                    <p class="card-text">Chat with feed suppliers</p>
                    <div class="btn btn-light btn-lg w-100 fw-bold text-warning">
                        <i class="fas fa-comments me-2"></i>Chat Now
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 col-lg-3">
            <div class="card border-0 shadow-lg h-100 hover-card" style="background: linear-gradient(135deg, #f3e5f5 0%, #9c27b0 100%); cursor: pointer;" onclick="location.href='{{ url_for('training') }}'">
                <div class="card-body text-center text-white">
                    <div class="mb-3">
                        <i class="fas fa-book-open fa-4x mb-2"></i>
                        <h5 class="card-title fw-bold">üìö ‡§∏‡•Ä‡§ñ‡•á‡§Ç</h5>
                        <h6 class="card-subtitle">Learn</h6>
                    </div>
                    <p class="card-text">Training & best practices</p>
                    <div class="btn btn-light btn-lg w-100 fw-bold text-purple">
                        <i class="fas fa-graduation-cap me-2"></i>Start Learning
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle task completion
    document.querySelectorAll('.complete-task').forEach(button => {
        button.addEventListener('click', function() {
            const taskId = this.dataset.taskId;
            
            fetch(`/complete_task/${taskId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                }
            })
            .catch(error => console.error('Error:', error));
        });
    });
});
</script>
{% endblock %}
